{"version":3,"sources":["utilities/api/endpoints.ts","utilities/api/interactionManager.ts","pages/PassportRedemption/VoucherFront.png","pages/PassportRedemption/VoucherBack.png","pages/PassportRedemption/PassportVoucher.tsx"],"names":["baseUrl","process","sellers","charges","vouchers","passportVouchers","getSellers","lang","a","axios","get","params","locale","localeFromLanguage","getSeller","id","makeSquarePayment","nonce","sellerId","payment","buyer","isDistribution","campaignId","email","name","idempotencyKey","idempotency_key","isSubscribed","is_subscribed","post","is_square","line_items","seller_id","is_distribution","campaign_id","headers","then","res","catch","err","getVoucher","updateVoucher","amount","put","getMerchantGiftCards","secret","language","getCampaigns","getDistributor","getParticipatingMerchant","getParticipatingMerchantTickets","tickets_secret","module","exports","Voucher","useParams","useState","restaurantName","setRestaurantName","restaurantTickets","setRestaurantTickets","getAllTickets","data","allTickets","useEffect","Page","map","restaurant","idx","Container","Image","src","VoucherImage","ContainerInfo","RestaurantName","className","length","TicketNumber","code","formattedCode","split","splice","join","formatTicketCode","ticket_id","BackImage","styled","div","img"],"mappings":"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","file":"static/js/14.5e1fbb4b.chunk.js","sourcesContent":["const baseUrl = process.env.REACT_APP_API_ENDPOINT!;\n\nexport const sellers = baseUrl + 'sellers/';\nexport const charges = baseUrl + 'charges';\nexport const vouchers = baseUrl + 'gift_cards/';\nexport const campaigns = baseUrl + 'campaigns/';\nexport const distributors = baseUrl + 'distributors/';\nexport const passportVouchers = baseUrl + 'participating_sellers/';","import axios from 'axios';\nimport { CardElement } from '@stripe/react-stripe-js';\nimport { Buyer, PaymentParams, SquareLineItems } from './types';\nimport { charges, sellers, vouchers, campaigns, distributors, passportVouchers } from './endpoints';\n\n// Fix return typing\nexport const getSellers = async (lang?: string): Promise<any> => {\n  return await axios.get(sellers, {\n    params: { locale: localeFromLanguage(lang) },\n  });\n};\n\n// Fix return typing\nexport const getSeller = async (id: string, lang?: string): Promise<any> => {\n  return await axios.get(sellers + id, {\n    params: { locale: localeFromLanguage(lang) },\n  });\n};\n\n// TODO(ArtyEmsee): add typing for stripe elements\nexport const makePayment = async (\n  stripe: any,\n  elements: any,\n  payment: PaymentParams,\n  buyer: Buyer\n) => {\n  const { email, name } = buyer;\n\n  // TODO(ArtyEmsee): abstract api call, create global object for headers\n  await axios\n    .post(\n      charges,\n      {\n        is_square: false,\n        line_items: [payment],\n        email: email,\n      },\n      { headers: { 'Access-Control-Allow-Origin': '*' } }\n    )\n    .then(async (res) => {\n      // TODO(ArtyEmsee): fix response to success\n      if (!stripe || !elements) return;\n      else {\n        const cardElement = elements!.getElement(CardElement);\n        const result = await stripe!.confirmCardPayment(\n          `${res.data.client_secret}`,\n          {\n            payment_method: {\n              card: cardElement!,\n              billing_details: {\n                name: name,\n                email: email,\n              },\n            },\n          }\n        );\n\n        if (result.error) {\n          console.log(result.error.message);\n        } else {\n          if (result.paymentIntent?.status === 'succeeded') {\n            console.log(\n              result.paymentIntent?.status,\n              'The payment has been processed!'\n            );\n          }\n        }\n      }\n    });\n\n  // TODO(ArtyEmsee): fix response to error\n};\n\nexport const makeSquarePayment = async (\n  nonce: string,\n  sellerId: string,\n  payment: SquareLineItems,\n  buyer: Buyer,\n  isDistribution: boolean,\n  campaignId?: string\n) => {\n  const { email, name } = buyer;\n  const idempotencyKey = buyer.idempotency_key;\n  const isSubscribed = buyer.is_subscribed;\n\n  return await axios\n    .post(\n      charges,\n      {\n        is_square: true,\n        nonce,\n        line_items: payment,\n        email,\n        name,\n        seller_id: sellerId,\n        idempotency_key: idempotencyKey,\n        is_subscribed: isSubscribed,\n        is_distribution: isDistribution, // TODO: deprecate this in favor of campaignId\n        campaign_id: campaignId\n      },\n      { headers: { 'Access-Control-Allow-Origin': '*' } }\n    )\n    .then(async (res) => {\n      return res;\n    })\n    .catch((err) => {\n      throw err;\n    });\n};\n\nexport const getVoucher = async (id: string) =>\n  axios\n    .get(vouchers + id)\n    .then((res) => res)\n    .catch((err) => err);\n\nexport const updateVoucher = async (id: string, amount: number) =>\n  axios\n    .put(vouchers + id, { amount })\n    .then((res) => res)\n    .catch((err) => err);\n\nexport const getMerchantGiftCards = async (seller_id: string, secret: string) =>\n  axios.get(sellers + seller_id + '/gift_cards/' + secret).then((res) => res); // don't catch error, throw it up the stack\n\nfunction localeFromLanguage(language?: string) {\n  switch (language) {\n    case 'cn':\n      return 'zh-CN';\n    case 'en':\n    default:\n      return 'en';\n  }\n}\n\nexport const getCampaigns = async (): Promise<any> => {\n  return await axios.get(campaigns);\n};\n\nexport const getDistributor = async (id: string): Promise<any> => {\n  return await axios.get(distributors + id)\n    .then((res) => res)\n    .catch((err) => err);\n}\n\n// for passport crawl voucher print outs\nexport const getParticipatingMerchant = async (id: string) =>\n  axios\n    .get(passportVouchers + id)\n    .then((res) => res)\n    .catch((err) => err);\n\nexport const getParticipatingMerchantTickets = async (\n  id: string,\n  tickets_secret: string\n) =>\n  axios\n    .get(passportVouchers + id + '/tickets/' + tickets_secret)\n    .then((res) => res)\n    .catch((err) => err);\n","module.exports = __webpack_public_path__ + \"static/media/VoucherFront.17e749a1.png\";","module.exports = __webpack_public_path__ + \"static/media/VoucherBack.53dab2f2.png\";","import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useParams } from 'react-router-dom';\n\nimport {\n  getParticipatingMerchant,\n  getParticipatingMerchantTickets,\n} from '../../utilities/api/interactionManager';\n\nimport { LoaderFillerContainer } from '../../components/Loader';\nimport VoucherImage from './VoucherFront.png';\nimport BackImage from './VoucherBack.png';\n\nconst Voucher = () => {\n  const { id, tickets_secret } = useParams();\n\n  const [restaurantName, setRestaurantName] = useState('');\n  const [restaurantTickets, setRestaurantTickets] = useState<any | null>();\n\n  const getAllTickets = async () => {\n    const { data: { name } } = await getParticipatingMerchant(id);\n    const { data: allTickets } = await getParticipatingMerchantTickets(id, tickets_secret);\n\n    if (allTickets && name) {\n      setRestaurantName(name);\n      setRestaurantTickets(allTickets);\n    }\n  };\n\n  useEffect(() => {\n    getAllTickets();\n  });\n\n  const formatTicketCode = (code) => {\n    const formattedCode = code.split('');\n    formattedCode.splice(3, 0, '-');\n    return formattedCode.join('');\n  };\n\n  return restaurantTickets ? (\n    <Page>\n      {restaurantTickets.map((restaurant, idx) => (\n        <>\n          <Container>\n            <Image src={VoucherImage} />\n            <ContainerInfo>\n              <RestaurantName\n                className={restaurantName.length > 15 ? 'long' : ''}\n              >\n                {restaurantName}\n              </RestaurantName>\n              <TicketNumber>\n                {formatTicketCode(restaurant.ticket_id)}\n              </TicketNumber>\n            </ContainerInfo>\n          </Container>\n          {(idx + 1) % 4 === 0 && (\n            <>\n              <Image src={BackImage} />\n              <Image src={BackImage} />\n              <Image src={BackImage} />\n              <Image src={BackImage} />\n            </>\n          )}\n        </>\n      ))}\n    </Page>\n  ) : (\n    <LoaderFillerContainer />\n  );\n};\n\nexport default Voucher;\n\nconst Page = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nconst Container = styled.div`\n  height: 599px;\n  width: 775px;\n  display: grid;\n  grid-template-rows: 1fr;\n`;\n\nconst Image = styled.img`\n  height: 599px;\n  width: 775px;\n  grid-row: 1;\n  grid-column: 1;\n`;\n\nconst ContainerInfo = styled.div`\n  grid-row: 1;\n  grid-column: 1;\n  height: 599px;\n  width: 775px;\n  display: flex;\n  z-index: 5;\n`;\n\nconst RestaurantName = styled.div`\n  font-family: 'Nova Mono';\n  text-transform: uppercase;\n  color: #bc4f5e;\n\n  transform: rotate(15deg);\n  -webkit-transform: rotate(15deg);\n  -moz-transform: rotate(15deg);\n  -ms-transform: rotate(15deg);\n  -o-transform: rotate(15deg);\n\n  margin-top: 317px;\n  margin-left: 100px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n\n  width: 150px;\n  height: 25px;\n  padding: 0;\n\n  &.long {\n    margin-top: 312px;\n    font-size: 12px;\n    height: 35px;\n  }\n`;\n\nconst TicketNumber = styled.div`\n  color: #a8192e;\n  font-weight: bold;\n  font-style: italic;\n  font-size: 50px;\n  margin: 160px 0 0 210px;\n\n  width: 285px;\n  text-align: center;\n`;\n"],"sourceRoot":""}